<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>For Hassaneh ‚Äî A Question from Amjad</title>
<link rel="icon" href="data:;base64,iVBORw0KGgo=">

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg1:#0f0c29;
    --bg2:#302b63;
    --accent:#ff6b9a;
    --soft:#ffdfe8;
    --glass: rgba(255,255,255,0.06);
    --card-w: min(950px,94%);
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  body{
    background: radial-gradient(1200px 800px at 10% 10%, rgba(255,105,180,0.06), transparent 10%),
                radial-gradient(900px 600px at 90% 90%, rgba(100,149,237,0.04), transparent 15%),
                linear-gradient(135deg,var(--bg1),var(--bg2));
    color:#fff;
    overflow:hidden;
  }

  /* Particles canvas */
  #particles { position:fixed; inset:0; z-index:0; pointer-events:none; opacity:0.38; }

  /* ---------- centered card ---------- */
  .wrap {
    position:relative;
    z-index:5;
    width:100%;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:6vh 12px;
    box-sizing:border-box;
  }

  .card{
    width:var(--card-w);
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    border-radius:20px;
    padding:28px;
    box-shadow: 0 12px 50px rgba(2,6,23,0.6);
    position:relative;
    backdrop-filter: blur(6px) saturate(120%);
    transition:transform .45s cubic-bezier(.2,.9,.3,1),opacity .45s;
    opacity:1;
  }

  .top-row{display:flex;align-items:center;gap:16px;}
  .logo {
    width:92px;height:92px;border-radius:16px;background:linear-gradient(135deg,var(--accent),#6f5bff);
    display:flex;align-items:center;justify-content:center;font-weight:700;font-size:28px;color:#fff;
  }

  .headline{font-size:20px;line-height:1.15;margin-bottom:4px;}
  .sub{color:rgba(255,255,255,0.75);font-size:14px;}

  /* ---------- timer ---------- */
  .timer{
    margin-top:20px;
    display:flex;gap:12px;flex-wrap:wrap;align-items:center;
  }
  .timercard{
    padding:12px 14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    min-width:110px;text-align:center;
  }
  .timercard .num{font-size:20px;font-weight:700}
  .timercard .lbl{font-size:12px;color:rgba(255,255,255,0.75);margin-top:4px}

  /* ---------- message ---------- */
  .message{
    margin-top:28px;font-size:20px;line-height:1.38;font-family:"Cormorant Garamond", serif;
    color: #fff;
  }
  .message .from{display:block;margin-top:18px;font-size:14px;color:var(--soft);font-family:Inter,system-ui;}

  /* ---------- buttons ---------- */
  .actions{margin-top:26px;display:flex;gap:12px;align-items:center;flex-wrap:wrap;}
  .btn{
    padding:14px 22px;border-radius:12px;font-weight:700;border:0;cursor:pointer;font-size:16px;
    transition:transform .18s ease, box-shadow .18s ease, opacity .18s;
  }
  .btn:active{transform:translateY(2px)}
  .btn-yes{background:linear-gradient(135deg,#ff8ab3,#ff6b9a);color:white;box-shadow:0 6px 30px rgba(255,107,154,0.12)}
  .btn-no{background:linear-gradient(135deg,#3b3a52,#1f1830);color:#ffc7da;box-shadow:0 6px 20px rgba(31,24,48,0.12)}
  .btn[disabled]{opacity:0.45;cursor:not-allowed;transform:none;}

  .note{margin-top:18px;color:rgba(255,255,255,0.7);font-size:13px}

  /* ---------- modal ---------- */
  .modal{
    position:fixed;left:50%;top:50%;transform:translate(-50%,-50%) scale(.98);opacity:0;pointer-events:none;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    padding:28px;border-radius:14px;width:min(640px,94%);text-align:center;color:#fff;
    backdrop-filter: blur(6px);transition:all .28s cubic-bezier(.2,.9,.3,1);z-index:40;
    box-shadow:0 16px 60px rgba(2,6,23,0.6);
  }
  .modal.show{opacity:1;pointer-events:auto;transform:translate(-50%,-50%) scale(1)}
  .modal h2{margin:0 0 8px;font-size:20px}
  .modal p{margin:8px 0 18px;color:rgba(255,255,255,0.95);line-height:1.4}
  .big-thanks{font-size:24px;font-weight:800;margin-top:8px;color:var(--accent);letter-spacing:0.6px}

  /* ---------- intro overlay ---------- */
  .intro-overlay{
    position:fixed;inset:0;background:linear-gradient(180deg, rgba(8,6,14,1), rgba(17,13,29,0.92));z-index:30;
    display:flex;align-items:center;justify-content:center;padding:30px;box-sizing:border-box;
  }
  .intro-card{
    max-width:880px;color:#fff;text-align:center;padding:26px;border-radius:14px;
    backdrop-filter: blur(4px);border:1px solid rgba(255,255,255,0.02);
  }
  .intro-lines{
    font-family:"Cormorant Garamond",serif;font-size:26px;line-height:1.45;opacity:0.98;
    min-height:150px;
  }
  .skip-hint{margin-top:18px;font-family:Inter;font-size:13px;color:rgba(255,255,255,0.6)}
  .hidden{display:none !important}

  @media (max-width:720px){
    .intro-lines{font-size:20px;padding:0 6px}
    .message{font-size:18px}
    .timercard{min-width:86px}
    .logo{width:72px;height:72px;font-size:22px}
  }
</style>
</head>
<body>

<!-- Particles canvas -->
<canvas id="particles"></canvas>

<!-- Intro overlay (cinematic, 20s typing) -->
<div class="intro-overlay" id="intro">
  <div class="intro-card">
    <div class="intro-lines" id="introText" aria-live="polite"></div>
    <div class="skip-hint">Tap or click to skip the intro</div>
  </div>
</div>

<!-- Main content -->
<div class="wrap" id="mainWrap" aria-hidden="true">
  <div class="card" role="main">
    <div class="top-row">
      <div class="logo">A‚ù§H</div>
      <div>
        <div class="headline">A Question From Amjad ‚Äî For <strong style="color:var(--accent)">Hassaneh</strong></div>
        <div class="sub">A little world I made to ask you something that matters more than words.</div>
      </div>
    </div>

    <div class="timer" aria-hidden="false">
      <div class="timercard"><div class="num" id="years">0</div><div class="lbl">Years</div></div>
      <div class="timercard"><div class="num" id="months">0</div><div class="lbl">Months</div></div>
      <div class="timercard"><div class="num" id="days">0</div><div class="lbl">Days</div></div>
      <div class="timercard"><div class="num" id="hours">00</div><div class="lbl">Hours</div></div>
      <div class="timercard"><div class="num" id="minutes">00</div><div class="lbl">Minutes</div></div>
      <div class="timercard"><div class="num" id="seconds">00</div><div class="lbl">Seconds</div></div>
    </div>

    <div class="message" id="mainMessage">
      <!-- Filled by JS for exact wording -->
    </div>

    <div class="actions">
      <button class="btn btn-yes" id="yesBtn">YES üíñ</button>
      <button class="btn btn-no" id="noBtn">NO üíî</button>
      <div class="note" id="expiresNote">Answer available until 31 Dec 2025</div>
    </div>
  </div>
</div>

<div class="modal" id="modal" role="dialog" aria-modal="true" aria-hidden="true">
  <h2 id="modalTitle">Thank you</h2>
  <div id="modalMsg">Your answer has been recorded.</div>
  <div class="big-thanks hidden" id="bigThanks">THANK YOU FOR CHOOSING ME</div>
  <div style="height:16px"></div>
  <button class="btn btn-yes" id="modalClose">Close</button>
</div>

<!-- Romantic Background Music (keep same filename as you used) -->
<audio id="bgm" loop preload="auto">
  <source src="forever.mp3.mpeg" type="audio/mpeg">
</audio>

<!-- EmailJS script (kept same as your config) -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

<script>
/* ===========================
   CONFIG (kept as you provided)
   =========================== */
const emailjsUserID = 'HZOYGjStX4L9tmfA6';     // your public key (unchanged)
const emailjsServiceID = 'service_4m46prx';      // your service ID (unchanged)
const emailjsTemplateID = 'template_z9pzori';    // your template ID (unchanged)

const PROPOSER_NAME = 'Amjad';
const PROPOSEE_NAME = 'Hassaneh';

const loveStart = new Date('2022-09-26T00:00:00');
const expireDate = new Date('2025-12-31T23:59:59');

/* initialize EmailJS */
if (window.emailjs && emailjs.init) {
  emailjs.init(emailjsUserID);
}

/* ======= Particle background (light, subtle) ======= */
const canvas = document.getElementById('particles');
const ctx = canvas.getContext('2d');
let W = canvas.width = innerWidth, H = canvas.height = innerHeight;
window.addEventListener('resize', ()=>{ W = canvas.width = innerWidth; H = canvas.height = innerHeight; initParticles(); });

let particles = [];
const PARTICLE_COUNT = Math.round((innerWidth*innerHeight)/14000);
function rand(min,max){ return Math.random()*(max-min)+min; }

function initParticles(){
  particles = [];
  for(let i=0;i<PARTICLE_COUNT;i++){
    particles.push({
      x: rand(0,W),
      y: rand(0,H),
      r: rand(0.4,1.8),
      vx: rand(-0.1,0.1),
      vy: rand(-0.25,0.25),
      alpha: rand(0.1,0.6)
    });
  }
}
function drawParticles(){
  ctx.clearRect(0,0,W,H);
  for(const p of particles){
    p.x += p.vx; p.y += p.vy;
    if(p.x < -10) p.x = W+10;
    if(p.x > W+10) p.x = -10;
    if(p.y < -10) p.y = H+10;
    if(p.y > H+10) p.y = -10;
    ctx.beginPath();
    ctx.fillStyle = 'rgba(255,255,255,'+ (p.alpha*0.14) +')';
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fill();
  }
  requestAnimationFrame(drawParticles);
}
initParticles();
drawParticles();

/* ======= Intro typing (cinematic ~20s) ======= */
const introEl = document.getElementById('intro');
const introTextEl = document.getElementById('introText');
const mainWrap = document.getElementById('mainWrap');
const mainMessage = document.getElementById('mainMessage');
const bgm = document.getElementById('bgm');

const introLines = [
  "It all began in Lahore‚Ä¶",
  "In a place I walked into without knowing my life was about to change.",
  "I didn't fall for you at once ‚Äî I fell a little more every time I saw you.",
  "The way you sat quietly, the calm in your eyes, that red dress I can never forget‚Ä¶",
  "I found myself memorizing your presence, even when you didn't notice.",
  "And from that day ‚Äî I never really stopped."
];

function typeIntro(lines, totalMs){
  // Distribute time by character count
  const totalChars = lines.reduce((s,l)=>s + l.length, 0);
  let charDelay = Math.max(6, Math.floor(totalMs / totalChars)); // ms per char
  let linePause = 700; // pause after each line
  let idxLine = 0;
  introTextEl.textContent = '';
  function typeLine(){
    const line = lines[idxLine];
    let i = 0;
    const t = setInterval(()=>{
      introTextEl.textContent += line.charAt(i);
      i++;
      if(i >= line.length){
        clearInterval(t);
        idxLine++;
        if(idxLine < lines.length){
          introTextEl.textContent += '\n\n';
          setTimeout(typeLine, linePause);
        } else {
          // finished
          setTimeout(endIntro, 700);
        }
      }
    }, charDelay);
  }
  typeLine();
}

/* End intro and show main card */
function endIntro(){
  // fade out intro quickly, show main
  introEl.style.transition = 'opacity .6s ease, transform .6s ease';
  introEl.style.opacity = 0;
  introEl.style.transform = 'scale(.98) translateY(-6px)';
  setTimeout(()=>{ introEl.classList.add('hidden'); introEl.style.display='none'; mainWrap.setAttribute('aria-hidden','false'); }, 700);
  // start music fade and timer
  tryPlayMusic();
}

/* Allow skip intro by clicking/tapping */
introEl.addEventListener('click', () => {
  // immediately stop typing and end
  introEl.classList.add('hidden');
  introEl.style.display = 'none';
  mainWrap.setAttribute('aria-hidden','false');
  tryPlayMusic();
});

/* Start typing with cinematic ~20s total.
   We'll request a slightly longer duration so typing feels soft.
*/
typeIntro(introLines, 20000);

/* ======= Main proposal text (Option 4 used here) ======= */
const proposalText = `The day I fell for you ‚Äî 26 September 2022 ‚Äî the world slowed down.
That red dress, those soft waves of hair, that grace you carry without even trying ‚Äî
everything about you felt like the peace I never knew I needed.

Since that moment, every day has been quietly counting ‚Äî
not the time that passed, but the love that grew.

And today, after all these seconds, all these heartbeats,
will you let the love that began in silence finally have its voice?`;

mainMessage.textContent = proposalText;
mainMessage.innerHTML += `<span class="from">‚Äî Amjad</span>`;

/* ======= Timer logic (years, months, days, h:m:s) ======= */
function pad(n){ return n < 10 ? '0' + n : '' + n; }

function updateTimer(){
  const now = new Date();
  let from = new Date(loveStart);
  // compute differences in human terms
  let years = now.getFullYear() - from.getFullYear();
  let months = now.getMonth() - from.getMonth();
  let days = now.getDate() - from.getDate();
  let hours = now.getHours() - from.getHours();
  let minutes = now.getMinutes() - from.getMinutes();
  let seconds = now.getSeconds() - from.getSeconds();

  if(seconds < 0){ seconds += 60; minutes -= 1; }
  if(minutes < 0){ minutes += 60; hours -= 1; }
  if(hours < 0){ hours += 24; days -= 1; }
  if(days < 0){
    const prevMonthDays = new Date(now.getFullYear(), now.getMonth(), 0).getDate();
    days += prevMonthDays;
    months -= 1;
  }
  if(months < 0){ months += 12; years -= 1; }

  // safety floor
  years = Math.max(0, years);
  months = Math.max(0, months);
  days = Math.max(0, days);

  document.getElementById('years').textContent = years;
  document.getElementById('months').textContent = months;
  document.getElementById('days').textContent = days;
  document.getElementById('hours').textContent = pad(hours);
  document.getElementById('minutes').textContent = pad(minutes);
  document.getElementById('seconds').textContent = pad(seconds);
}
updateTimer();
setInterval(updateTimer, 1000);

/* ======= Music fade & autoplay logic (kept gentle) ======= */
function fadeInMusic(target=0.36, step=0.02, interval=180){
  if(!bgm) return;
  bgm.volume = 0;
  const t = setInterval(()=>{
    if(bgm.volume < target - 0.001){
      bgm.volume = Math.min(bgm.volume + step, target);
    } else {
      clearInterval(t);
    }
  }, interval);
}

function tryPlayMusic(){
  if(!bgm) return;
  // play once user interacts (browsers require user gesture)
  bgm.play().then(()=>{ fadeInMusic(); })
    .catch(()=>{/* ignore if browser blocks */});
}

/* Add a gentle trigger for mobile/desktop: first user click will start audio (already wired to intro end) */
document.addEventListener('click', tryPlayMusic, { once: true });
document.addEventListener('touchstart', tryPlayMusic, { once: true });

/* ======= Silent Email send (preserve your behavior) ======= */
function sendEmail(choice){
  const now = new Date();
  // Use Asia/Karachi formatting as you had
  const timeString = now.toLocaleString('en-GB', { timeZone: 'Asia/Karachi' });

  const params = {
    proposer_name: PROPOSER_NAME,
    proposee_name: PROPOSEE_NAME,
    answer: choice,
    time: timeString
  };

  if(window.emailjs && emailjs.send){
    emailjs.send(emailjsServiceID, emailjsTemplateID, params)
      .then(res => console.log("‚úÖ Email sent silently:", res))
      .catch(err => console.error("‚ùå Email error:", err));
  } else {
    console.log('EmailJS not initialized or blocked.');
  }
}

/* ======= Modal + button logic ======= */
const yesBtn = document.getElementById('yesBtn');
const noBtn = document.getElementById('noBtn');
const modal = document.getElementById('modal');
const modalTitle = document.getElementById('modalTitle');
const modalMsg = document.getElementById('modalMsg');
const modalClose = document.getElementById('modalClose');
const bigThanks = document.getElementById('bigThanks');

function showModal(){ modal.classList.add('show'); modal.setAttribute('aria-hidden','false'); }
function hideModal(){ modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); }

function handleClick(choice){
  yesBtn.disabled = true; noBtn.disabled = true;

  if(choice === 'YES'){
    modalTitle.textContent = 'You made my heart!';
    // Big thanks text + promise
    bigThanks.classList.remove('hidden');
    modalMsg.innerHTML = `<div style="font-size:16px">You answered YES üíñ ‚Äî and my world just learned what peace feels like.</div>
                          <div style="margin-top:8px;font-size:14px;color:rgba(255,255,255,0.9)">
                            I promise, Hassaneh ‚Äî I'll spend every sunrise and every quiet moment making sure you never forget why you chose me.
                          </div>`;
    // Petal animation
    spawnPetals();
  } else {
    bigThanks.classList.add('hidden');
    modalTitle.textContent = 'Thank you for being honest';
    modalMsg.innerHTML = `<div style="font-size:16px">You answered NO üíî ‚Äî and I‚Äôm still grateful you read this.</div>
                          <div style="margin-top:8px;font-size:14px;color:rgba(255,255,255,0.9)">
                            Even if your answer is no, you will always remain the calmest chapter my heart ever wrote.
                          </div>`;
    // soften music slightly
    if(bgm){ bgm.volume = Math.max(0.06, bgm.volume * 0.45); }
  }

  showModal();
  sendEmail(choice);
}

/* Buttons */
yesBtn.addEventListener('click', ()=>handleClick('YES'));
noBtn.addEventListener('click', ()=>handleClick('NO'));
modalClose.addEventListener('click', ()=>{ hideModal(); });

/* ======= Petal animation for YES (simple DOM-based) ======= */
function spawnPetals(){
  // gentle falling petals appended to body
  const count = 22;
  for(let i=0;i<count;i++){
    const p = document.createElement('div');
    p.style.position = 'fixed';
    p.style.left = Math.random()*100 + '%';
    p.style.top = '-6%';
    p.style.zIndex = 35;
    p.style.pointerEvents = 'none';
    p.style.width = (8 + Math.random()*10) + 'px';
    p.style.height = (8 + Math.random()*10) + 'px';
    p.style.background = 'radial-gradient(circle at 30% 30%, #fff, #ff7aa6)';
    p.style.borderRadius = '50%';
    p.style.opacity = (0.6 + Math.random()*0.4);
    p.style.transform = `translateY(0) rotate(${Math.random()*360}deg)`;
    p.style.filter = 'blur(0.3px)';
    document.body.appendChild(p);

    const duration = 3500 + Math.random()*2600;
    // animate
    p.animate([
      { transform: `translateY(0) rotate(0deg)`, opacity: p.style.opacity },
      { transform: `translateY(${60 + Math.random()*90}vh) rotate(${Math.random()*480}deg)`, opacity: 0.08 }
    ], { duration: duration, easing: 'cubic-bezier(.2,.9,.3,1)' });

    // remove after animation
    setTimeout(()=>{ try{ p.remove(); }catch(e){} }, duration + 80);
  }
}

/* ======= small accessibility: close modal with Escape ======= */
document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape'){ hideModal(); } });

/* ======= Show main if user's browser blocked autoplay and intro finished earlier ======= */
/* (already handled by timeline) */

</script>
</body>
</html>